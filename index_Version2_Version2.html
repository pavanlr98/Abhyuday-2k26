<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Watch Video â€” Then Form</title>

  <style>
    :root { --bg:#0f1724; --card:#071024; --accent:#06b6d4; --text:#e6eef8; }
    html,body {
      height:100%; margin:0;
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:var(--bg); color:var(--text);
      display:flex; align-items:center; justify-content:center;
    }
    .card {
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      padding:20px; border-radius:12px;
      width:min(960px,96%);
      box-shadow:0 6px 30px rgba(2,6,23,0.6);
    }
    header img {
      display:block; margin:0 auto 12px auto;
      max-width:240px; height:auto;
    }
    h1 { margin:0 0 8px 0; font-size:1.25rem; text-align:center; }
    p { margin:0 0 16px 0; color:#9fbfdc; text-align:center; }

    .player-wrap { position:relative; background:#000; border-radius:8px; overflow:hidden; }
    #player { display:block; width:100%; height:540px; background:#000; }

    .controls { display:flex; gap:12px; align-items:center; margin-top:12px; }
    .btn { background:var(--accent); color:#042330; border:none;
      padding:8px 12px; border-radius:8px; font-weight:600; cursor:pointer;
    }
    .btn.secondary {
      background:transparent; color:var(--text);
      border:1px solid rgba(255,255,255,0.06);
    }
    .progress { flex:1; height:10px; background:#0b1a2b;
      border-radius:6px; overflow:hidden; position:relative; cursor:pointer;
    }
    .progress > i {
      position:absolute; left:0; top:0; bottom:0;
      width:0%; background:linear-gradient(90deg,#60a5fa,#06b6d4);
      transition:width .12s linear;
    }
    .time { min-width:100px; text-align:right;
      color:#9fbfdc; font-weight:600;
    }
    .hint {
      margin-top:10px; font-size:0.92rem; color:#a9c3d9;
      text-align:center;
    }

    @media (max-width:720px) {
      #player { height:260px; }
      .time { min-width:70px; font-size:0.92rem; }
    }
  </style>
</head>

<body>
  <main class="card" role="main">

    <!-- LOGO HEADER (replace src with direct image file if possible) -->
    <header>
      <img src="https://www.google.com/search?sca_esv=4dde0993aef9cf17&biw=1536&bih=730&aic=0&sxsrf=ANbL-n6GH25-G62MqAmu3sQB-H7InfuARw:1770056354181&q=parivarthana+business+school+logo&uds=ALYpb_ncDc7jTlmw6Mmq7NjuX5c-_ijGqx3TV_QauseM21ejn1BQZhUPS5s38HkkBGCnEVUKaheshTylYLS6rWIATNt_oyhep_0ilN7xOFxTdSMi0zgXcqBjIedhsMU2hx3HJouRphNm0945ylGzDh06u5J8t54TTNIq9Lqpoye0K8HvadyNRzY&udm=2&sa=X&ved=2ahUKEwjWtuThtbuSAxVx2TgGHVihH9MQxKsJKAB6BAgREAE&ictx=0" alt="Parivarthana Business School Logo">
    </header>

    <h1>Please watch the full video</h1>
    <p>The Google Form will open automatically when the video finishes.</p>

    <div class="player-wrap" aria-label="YouTube player">
      <div id="player"></div>
    </div>

    <div class="controls" aria-hidden="false">
      <button id="playBtn" class="btn">Play</button>
      <button id="pauseBtn" class="btn secondary" style="display:none;">Pause</button>
      <div id="progress" class="progress" title="Click to seek (forward seeking is disabled)">
        <i id="bar"></i>
      </div>
      <div id="timeLabel" class="time">0:00 / 0:00</div>
    </div>

    <div class="hint">
      Forward seeking is disabled while watching (best-effort).
      If you reload, playback resumes from where you left off in this session.
    </div>
  </main>

  <script>
    const VIDEO_ID = 'dY2sORh1SwM';
    const FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfL5MQHS-cdhk0r3rKpM2xXZARfmZNpCt6KDpD4D5gZdu_Ecg/viewform';
    const FORWARD_ALLOWANCE = 0.4;
    const POLL_INTERVAL_MS = 250;
    const STORAGE_KEY = `yt_watch_last_time_${VIDEO_ID}`;

    const playBtn = document.getElementById('playBtn');
    const pauseBtn = document.getElementById('pauseBtn');
    const bar = document.getElementById('bar');
    const progress = document.getElementById('progress');
    const timeLabel = document.getElementById('timeLabel');

    let player = null;
    let pollTimer = null;
    let lastApproved = parseFloat(sessionStorage.getItem(STORAGE_KEY) || '0') || 0;
    let duration = 0;
    let durationKnown = false;

    function formatTime(s) {
      if (!isFinite(s)) return '0:00';
      const m = Math.floor(s / 60);
      const sec = Math.floor(s % 60).toString().padStart(2, '0');
      return `${m}:${sec}`;
    }

    function updateTimeUI(cur) {
      const pct = duration ? (cur / duration) * 100 : 0;
      bar.style.width = pct + '%';
      timeLabel.textContent = `${formatTime(cur)} / ${formatTime(duration)}`;
    }

    function startPolling() {
      if (pollTimer) return;
      pollTimer = setInterval(() => {
        const cur = player.getCurrentTime();
        if (cur > lastApproved + FORWARD_ALLOWANCE) {
          player.seekTo(lastApproved, true);
          return;
        }
        lastApproved = Math.max(lastApproved, cur);
        sessionStorage.setItem(STORAGE_KEY, String(lastApproved));
        updateTimeUI(cur);
      }, POLL_INTERVAL_MS);
    }

    function stopPolling() {
      clearInterval(pollTimer);
      pollTimer = null;
    }

    playBtn.addEventListener('click', () => {
      if (!player) return;

      player.unMute();
      player.setVolume(100);

      const iframe = player.getIframe();
      const requestFS =
        iframe.requestFullscreen ||
        iframe.webkitRequestFullscreen ||
        iframe.mozRequestFullScreen ||
        iframe.msRequestFullscreen;

      if (requestFS) requestFS.call(iframe);

      player.playVideo();
    });

    pauseBtn.addEventListener('click', () => {
      player.pauseVideo();
    });

    progress.addEventListener('click', ev => {
      if (!durationKnown) return;
      const rect = progress.getBoundingClientRect();
      const target = ((ev.clientX - rect.left) / rect.width) * duration;
      if (target <= lastApproved + FORWARD_ALLOWANCE) {
        player.seekTo(target, true);
        updateTimeUI(target);
      }
    });

    function onPlayerReady(event) {
      const trySetDuration = () => {
        const d = player.getDuration();
        if (d > 0) {
          duration = d;
          durationKnown = true;
          if (lastApproved < duration - 0.5) {
            player.seekTo(lastApproved, true);
          }
          updateTimeUI(lastApproved || 0);
        } else {
          setTimeout(trySetDuration, 300);
        }
      };
      trySetDuration();
    }

    function onPlayerStateChange(event) {
      const state = event.data;
      if (state === YT.PlayerState.PLAYING) {
        playBtn.style.display = 'none';
        pauseBtn.style.display = '';
        startPolling();
      } else {
        playBtn.style.display = '';
        pauseBtn.style.display = 'none';
        stopPolling();
      }
      if (state === YT.PlayerState.ENDED) {
        sessionStorage.removeItem(STORAGE_KEY);
        window.location.href = FORM_URL;
      }
    }

    (function loadYouTubeAPI() {
      const tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      document.getElementsByTagName('script')[0].parentNode.insertBefore(tag, null);
    })();

    window.onYouTubeIframeAPIReady = function() {
      player = new YT.Player('player', {
        height: '540',
        width: '960',
        videoId: VIDEO_ID,
        playerVars: {
          controls: 0,
          modestbranding: 1,
          rel: 0,
          disablekb: 1,
          fs: 1,
          playsinline: 0,
          autoplay: 0,
          mute: 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    };

    window.addEventListener('beforeunload', () => {
      if (lastApproved) sessionStorage.setItem(STORAGE_KEY, String(lastApproved));
    });
  </script>
</body>
</html>
